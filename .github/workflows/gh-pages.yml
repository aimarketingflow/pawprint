name: GitHub Pages

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
      - '**.md'
      - '.github/workflows/gh-pages.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material pymdown-extensions
          
      - name: Setup Pages
        uses: actions/configure-pages@v3
        
      - name: Create mkdocs.yml
        run: |
          cat > mkdocs.yml << EOL
          site_name: Pawprinting PyQt6 V2
          site_description: Digital forensic pawprinting tool with automation capabilities
          repo_url: https://github.com/aimarketingflow/pawprint
          theme:
            name: material
            palette:
              scheme: slate
              primary: deep purple
              accent: purple
            features:
              - navigation.tabs
              - navigation.sections
              - navigation.expand
              - search.suggest
              - search.highlight
          markdown_extensions:
            - pymdownx.highlight
            - pymdownx.superfences
            - pymdownx.tabbed
            - pymdownx.keys
            - pymdownx.mark
            - pymdownx.critic
            - admonition
            - footnotes
            - toc:
                permalink: true
          nav:
            - Home: 'index.md'
            - User Guides:
                - 'CLI Terminal Guide': 'Pawprint_CLI_Terminal_Guide.md'
                - 'Automation Guide': 'Pawprint_Automation_Terminal_Guide.md'
            - Development:
                - 'Development Guide': 'Development_Guide.md'
                - 'Contributing': '../CONTRIBUTING.md'
                - 'Changelog': '../CHANGELOG.md'
          EOL
          
      - name: Prepare documentation
        run: |
          mkdir -p docs_site
          cp README.md docs_site/index.md
          cp -r docs/* docs_site/
          cp CONTRIBUTING.md CHANGELOG.md docs_site/
          
      - name: Build with MkDocs
        run: mkdocs build --config-file=mkdocs.yml --site-dir=_site
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
